---
title: "MAT02035 - Modelos para dados correlacionados"
subtitle: "Introdução aos dados longitudinais e agrupados"
fontsize: 10pt
author: |
  | Rodrigo Citton P. dos Reis
  | `citton.padilha@ufrgs.br`
institute: |
  | \textsc{Universidade Federal do Rio Grande do Sul}
  | \textsc{Instituto de Matemática e Estatística}
  | \textsc{Departamento de Estatística}
date: |
  | Porto Alegre, 2019
---

# Introdução

## Introdução

A pesquisa estatística em métodos para o delineamento e análise de investigações humanas expandiu explosivamente na segunda metade do século 20.

- Nos EUA (métada do século 20): mudança de suporte de pesquisa da área militar para a área biomédica.
- Nos EUA (1944): aprovação da Lei do Serviço de Saúde Pública $\Rightarrow$ crescimento do _National Institutes of Health_ (NIH\footnote{{\bf Um pouco da história do NIH:} www.nih.gov/about-nih/who-we-are/history}).
    + Orçamento do NIH: 1947 - \$8 milhões $\Rightarrow$ 1966 - \$1 bilhão.

## Introdução

- O NIH patrocinou vários dos estudos epidemiológicos importantes e ensaios clínicos daquele período, incluindo o \textbf{\emph{Framingham Heart Study}}\footnote{{\bf Um pouco da história do NIH:} www.ncbi.nlm.nih.gov/pmc/articles/PMC4159698/} (FHS).

- O foco destes primeiros estudos foi a __morbidade__ e, especialmente, a __mortalidade__.
    + Pesquisadores procuravam __identificar as causas__ da morte prematura e avaliar a efetividade dos tratamentos para atrasar a morte morbidade.
    + __Regressão logística__ (1960s).
    + A análise de dados de __tempo até o evento__ foi revolucionada pelo artigo de 1972 de \textbf{\textcolor{darkpastelgreen}{D. R. Cox}}\footnote{Reid, N. A Conversation with Sir David Cox. \emph{Statistical Science}, 9:439-455, 1994.}, descrevendo __modelo de riscos proporcionais__\footnote{\textbf{\textcolor{darkpastelpurple}{Leituras para o fim do dia:}} Cox, D. R. Regression Models and Life-Tables. \emph{Journal of the Royal Statistical Society. Series B}, 34:187-220, 1972.}.

## Introdução

- Embora o delineamento do FHS exigisse a __medição periódica__ das características do paciente, consideradas determinantes de doenças crônicas, o interesse pelos níveis e __padrões de mudança__ dessas características __ao longo do tempo__ foi inicialmente limitado.
- Com avanços da pesquisa, investigadores começaram a fazer perguntas sobre o __comportamento__ desses __fatores de risco__.
    + No FHS os pesquisadores começaram a perguntar se os __níveis de pressão arterial__ na infância eram preditivos de hipertensão na vida adulta.
    + No _Coronary Artery Risk Development in Young Adults_ (CARDIA) _Study_\footnote{Friedman, G. D \emph{et al}. CARDIA: study design, recruitment, and some characteristics of the examined subjects. \emph{Journal of Clinical Epidemiology}, 41:1105-1116, 1988.}, os investigadores procuraram identificar os determinantes da transição do estado normotenso\footnote{``pressão arterial normal''} ou normocolesterolêmico\footnote{``colesterol normal''} no início da vida adulta para hipertensão e hipercolesterolemia na meia-idade.

## Introdução

- No tratamento de artrite, asma e outras doenças que normalmente não ameaçam a vida, os pesquisadores começaram a estudar os efeitos dos tratamentos na mudança ao longo do tempo em medidas de gravidade da doença.
    + Questões semelhantes estavam sendo colocadas em todos os contextos de doenças.
- Os pesquisadores começaram a __acompanhar populações__ de todas as idades ao longo do tempo, tanto em estudos observacionais quanto em ensaios clínicos, para __entender o desenvolvimento e a persistência da doença e para identificar fatores que alteram o curso do desenvolvimento da doença__.

## Introdução

- Esse interesse nos padrões temporais de mudança nas características humanas ocorreu em um período em que os avanços no poder da computação tornaram novas e mais intensivas abordagens computacionais para a análise estatística disponíveis no desktop.

```{r echo=FALSE, fig.align='center', message=FALSE, warning=FALSE, out.width='70%', paged.print=FALSE}
knitr::include_graphics(here('images', 'dims.jpg'))
```

## Introdução

- \textbf{\textcolor{darkpastelgreen}{Laird e Ware}} propuseram o uso do algoritmo EM para ajustar uma classe de __modelos lineares de efeitos mistos__ apropriados para a análise de medidas repetidas\footnote{Laird, N. M., Ware, J. H. Random-effects models for longitudinal data. \emph{Biometrics}, 38:963-974, 1982.};
- Mais tarde na década, \textbf{\textcolor{darkpastelgreen}{Liang e Zeger}} introduziram as __equações de estimativas generalizadas__ na literatura bioestatística e propuseram uma família de modelos lineares generalizados para ajustar observações repetidas de dados binários e contados\footnote{Liang, K. Y., Zeger, S. L. Longitudinal Data Analysis Using Generalized Linear Models. \emph{Biometrika}, 73:13-22, 1986.}$^{,}$\footnote{Zeger, S. L., Liang, K. Y. Longitudinal Data Analysis for Discrete and Continuous Outcomes. \emph{Biometrics}, 42:121-130, 1986.}.

## Introdução

- Muitos outros pesquisadores que escrevem na literatura biomédica, educacional e psicométrica contribuíram para o rápido desenvolvimento de metodologia para a análise desses dados "longitudinais".
- Os últimos 40 anos assistiram a progressos consideráveis no desenvolvimento de métodos estatísticos para a análise de dados longitudinais. 
- Este curso apresentará parte desta literatura de maneira rigorosa apontando para as possibilidades de aplicação destas técnicas.
    
# Dados longitudinais e agrupados

## Estudos longitudinais

- A característica definidora de estudos longitudinais é que medidas dos mesmos indivíduos são tomadas __repetidamente__ através do tempo, assim permitindo o estudo direto da __mudança com o tempo__.

```{r echo=FALSE, fig.align='center', message=FALSE, warning=FALSE, out.width='90%', paged.print=FALSE}
knitr::include_graphics(here('images', 'levels_explanation.png'))
```

## Estudos longitudinais vs. estudos transversais

- Com medidas repetidas nos indivíduos, é possível capturar a __mudança dentro de indivíduo__.
- Em um __estudo transversal__, em que a resposta é medida em apenas uma ocasião, é possível apenas estimar __diferenças__ nas respostas __entre indivíduos__.
    + Permite comparações entre subpopulações que diferem em idade, mas não fornece qualquer informação a respeito de como os indivíduos mudam durante o correspondente período.

## Estudos longitudinais vs. estudos transversais

```{r echo=FALSE, fig.align='center', message=FALSE, warning=FALSE, out.width='100%', paged.print=FALSE}
knitr::include_graphics(here('images', 'CS_Vs_Longitudinal_Study.jpg'))
```

## Um exemplo:

## Dados longitudinais são dados agrupados

- Uma característica distintiva de dados longitudinais é que eles são __agrupados__.

```{r long_eh_agrupado, echo=FALSE, eval=TRUE, warning=FALSE, message=FALSE, fig.align='center', out.width="80%", out.height="70%"}
# ----------------------------------------------------
# Carregando pacotes do R

library(here)
library(haven)
library(tidyr)
library(ggplot2)

# ----------------------------------------------------
# Carregando o arquivo de dados

chol.df <- read_dta(file = here("data", "cholesterol.dta"))

# ----------------------------------------------------
# Reformando o objeto: de "largo" para "longo"

chol.df.longo <- gather(data = chol.df, key = "tempo", value = "colesterol", -id, -group)

# ----------------------------------------------------
# Formata variáveis

chol.df.longo$tempo <- as.factor(as.numeric(as.factor(chol.df.longo$tempo)))
chol.df.longo$group <- as.factor(chol.df.longo$group)
chol.df.longo$id <- as.factor(chol.df.longo$id)
# ----------------------------------------------------
# Gráfico de perfis

set.seed(10)
ids <- sample(x = unique(chol.df.longo$id), size = 5, replace = FALSE)

p <- ggplot(data = chol.df.longo[which(chol.df.longo$id %in% ids), ],
            mapping = aes(x = tempo, y = colesterol, group = id, colour = id)) +
  geom_line(size = 0.8) +
  labs(x = "Tempo", y = "Colesterol", colour = "ID")
p
```

- Cada indivíduo forma um grupo de observações repetidas ao longo do tempo.

## Dados agrupados

- Observações dentro de um grupo tipicamente irão exibir __correlação positiva__, e esta correlação __deve ser levada em conta__ na análise.
- Dados agrupados podem surgir de amostragens aleatórias de grupos que se caracterizam naturalmente na população:
    + Famílias;
    + Domicílios;
    + Enfermarias hospitalares;
    + Práticas médicas;
    + Vizinhanças;
    + Escolas.
- Ainda, dados agrupados podem surgir quando a resposta de interesse é simultaneamente obtida de múltiplos avaliadores (juízes, examinadores) ou de diferentes instrumentos de medição.

## Correlação

- Nestes casos, esperamos que medidas em unidades dentro de um grupo são mais similares que as medidas em unidades de grupos diferentes.
- O grau de agrupamento pode ser expresso em termos da __correlação__ entre as medidas em unidades do mesmo grupo.
- Esta correlação __invalida a suposição crucial de independência__ que é o pilar de tantas técnicas estatísticas.
    + Modelos estatísticos para dados correlacionados devem explicitamente descrever e lever em conta para esta correlação.

## Comentários

- Dados longitudinais são um caso especial de dados agrupados (com uma ordenação natural das medições dentro de um grupo),
    + Faremos a descrição dos métodos de análise para dados agrupados, mais amplamente definidos.
- Um dos objetivos deste curso é demonstrar que os métodos para a análise de dados longitudinais são, mais ou menos, casos especiais de métodos de regressão mais gerais para dados agrupados.
    + Como resultado, uma compreensão abrangente de métodos para a análise de dados longitudinais fornece a base para uma compreensão mais ampla de métodos para analisar a ampla gama de dados agrupados.
    
## Comentários

- Os exemplos descritos anteriormente consideram apenas um único nível de agrupamento.
- Mais recentemente, pesquisadores desenvolveram metodologia para a análise de __dados multiníveis__, em que as observações podem ser agrupadas em mais de um nível.
    + Os dados podem consistir em medições repetidas em pacientes agrupados por clínica. 
    + Os dados podem consistir em observações sobre crianças aninhadas dentro de salas de aula, aninhadas dentro das escolas.
- Os dados multiníveis serão discutidos no final do curso.

# Exemplos

# Modelos de regressão para respostas correlacionadas

## Por hoje é só! Sejam todos bem-vindos!

```{r echo=FALSE, fig.align='center', message=FALSE, warning=FALSE, out.width='100%', paged.print=FALSE}
knitr::include_graphics(here('images', 'long_study.jpg'))
```
